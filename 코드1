import pandas as pd
import matplotlib.pyplot as plt

# í•œê¸€ í°íŠ¸ ì„¤ì •
plt.rcParams['font.family'] = 'Malgun Gothic'

# íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°
file_path = r"C:\Users\pc\Desktop\BEU\BEU11.csv"
df = pd.read_csv(file_path)
df.columns = df.columns.str.strip()

# ë¹„ì¤‘ ì—´ ì²˜ë¦¬
df['ë¹„ì¤‘(%)'] = (
    df['ë¹„ì¤‘(%)']
    .astype(str)
    .str.replace('%', '')
    .str.replace(',', '')
    .astype(float)
)

# ----------------------------
# ğŸ¯ 1. Pie Chart - ë¹„ì¤‘(%)
# ----------------------------
df_pie = df.copy()
if 'í•©ê³„' in df_pie.iloc[-1, 0]:
    df_pie = df_pie[:-1]

# ê·¸ë˜í”„ ìœ„ì¹˜ ì„ ì • ì¡°ì • 
labels_order = df_pie['ê±´ë¬¼ìš©ë„ë³„'].tolist()
if 'ê¸°íƒ€' in labels_order and 'ê³µì—…ìš©' in labels_order:
    labels_order.remove('ê¸°íƒ€')
    idx = labels_order.index('ê³µì—…ìš©')
    labels_order.insert(idx + 1, 'ê¸°íƒ€')
    df_pie = (
        df_pie
        .set_index('ê±´ë¬¼ìš©ë„ë³„')
        .loc[labels_order]
        .reset_index()
    )

# íŒŒì´ ì°¨íŠ¸ ê·¸ë¦¬ê¸°
fig, ax = plt.subplots(figsize=(8, 8))
wedges, texts, autotexts = ax.pie(
    df_pie['ë¹„ì¤‘(%)'],
    labels=df_pie['ê±´ë¬¼ìš©ë„ë³„'],
    autopct='%1.1f%%',
    startangle=140,
    pctdistance=0.6,
    labeldistance=1.15,
    textprops={'fontsize': 12, 'fontweight': 'bold'}
)

# ë²”ë¡€ ìœ„ì¹˜ ì¡°ì •
ax.legend(
    wedges,
    df_pie['ê±´ë¬¼ìš©ë„ë³„'],
    title="ë²”ë¡€",
    loc='lower right',
    bbox_to_anchor=(1.25, 0),
    fontsize=12,
    title_fontsize=12
)

# ì œëª©
plt.title('ê±´ë¬¼ ìš©ë„ë³„ ì—ë„ˆì§€ ì‚¬ìš© ë¹„ì¤‘ (%)', fontsize=14, fontweight='bold')
plt.tight_layout()
plt.show()


# ----------------------------
# ğŸ¯ 2. ìˆ˜í‰ ëˆ„ì  ë§‰ëŒ€ ê·¸ë˜í”„ (ë‹¨ìœ„: ktoe)
# ----------------------------

# ëŒ€ìƒ ì—´
energy_cols = ['ì „ê¸°(toe)', 'ë„ì‹œê°€ìŠ¤(toe)', 'ì§€ì—­ë‚œë°©(toe)']

# ì‰¼í‘œ ì œê±° + float ë³€í™˜ + ë‹¨ìœ„ ë³€í™˜ (toe â†’ ktoe)
for col in energy_cols:
    df[col] = df[col].astype(str).str.replace(',', '').astype(float) / 1000

# ì´í•© ê¸°ì¤€ ì •ë ¬ìš© ì—´ ì¶”ê°€
df['ì´í•©'] = df[energy_cols].sum(axis=1)
df_sorted = df.sort_values(by='ì´í•©', ascending=True)

# ê·¸ë˜í”„ ê·¸ë¦¬ê¸°
plt.figure(figsize=(10, 6))
plt.barh(df_sorted['ê±´ë¬¼ìš©ë„ë³„'], df_sorted['ì „ê¸°(toe)'], label='ì „ê¸° (ktoe)')
plt.barh(df_sorted['ê±´ë¬¼ìš©ë„ë³„'], df_sorted['ë„ì‹œê°€ìŠ¤(toe)'],
         left=df_sorted['ì „ê¸°(toe)'], label='ë„ì‹œê°€ìŠ¤ (ktoe)')
plt.barh(df_sorted['ê±´ë¬¼ìš©ë„ë³„'], df_sorted['ì§€ì—­ë‚œë°©(toe)'],
         left=df_sorted['ì „ê¸°(toe)'] + df_sorted['ë„ì‹œê°€ìŠ¤(toe)'], label='ì§€ì—­ë‚œë°© (ktoe)')

plt.xlabel('ì—ë„ˆì§€ ì‚¬ìš©ëŸ‰ (ktoe)')
plt.title('ê±´ë¬¼ ìš©ë„ë³„ ì—ë„ˆì§€ì› ì‚¬ìš©ëŸ‰ (ktoe)')

# ë²”ë¡€ë¥¼ ê·¸ë˜í”„ ë‚´ë¶€ ì˜¤ë¥¸ìª½ í•˜ë‹¨ì— ìœ„ì¹˜
plt.legend(loc='lower right')

plt.tight_layout()
plt.show()
